<!DOCTYPE html> <html><head>
		<title>Setup Analysis Enviroment</title>
		<base href="..\..\..\..\../">
		<meta id="root-path" root-path="..\..\..\..\../">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0">
		<meta charset="UTF-8">
		<meta name="description" content="Hacking - Setup Analysis Enviroment">
		<meta property="og:title" content="Setup Analysis Enviroment">
		<meta property="og:description" content="Hacking - Setup Analysis Enviroment">
		<meta property="og:type" content="website">
		<meta property="og:url" content="notes/4.-cybersecurity/blueteam/malware-analysis/sistem/setup-analysis-enviroment.html">
		<meta property="og:image" content="lib\media\network_setup_malware_analysis.png">
		<meta property="og:site_name" content="Hacking">
		<link rel="alternate" type="application/rss+xml" title="RSS Feed" href="lib/rss.xml"><script async="" id="webpage-script" src="lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script type="module" async="" id="graph-view-script" src="lib/scripts/graph-view.js"></script><script async="" id="graph-wasm-script" src="lib/scripts/graph-wasm.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-render-worker-script" src="lib/scripts/graph-render-worker.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="tinycolor-script" src="lib/scripts/tinycolor.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="pixi-script" src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.0/pixi.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="minisearch-script" src="https://cdn.jsdelivr.net/npm/minisearch@6.3.0/dist/umd/index.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="lib/media/favicon.png"><script async="" id="graph-data-script" src="lib/scripts/graph-data.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-horizontal-spacing:0.6em;--tree-vertical-spacing:0.6em;--sidebar-margin:12px}.sidebar{height:100%;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));font-size:14px;z-index:10;position:relative;overflow:hidden;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}.sidebar-left{left:0}.sidebar-right{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}body.floating-sidebars .sidebar{position:absolute}.sidebar-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .sidebar-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}.sidebar-left .sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}.sidebar-right .sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar:has(.sidebar-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:2em;width:var(--sidebar-width);top:var(--sidebar-margin);padding-inline:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}.sidebar-left .sidebar-topbar{left:0}.sidebar-right .sidebar-topbar{right:0}.topbar-content{overflow:hidden;overflow:clip;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:0!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}.sidebar-left .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}.sidebar-right .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.sidebar-section-header{margin:0 0 1em 0;text-transform:uppercase;letter-spacing:.06em;font-weight:600}body{transition:background-color var(--color-fade-speed) ease-in-out}.webpage-container{display:flex;flex-direction:row;height:100%;width:100%;align-items:stretch;justify-content:center}.document-container{opacity:1;flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0;transition:opacity .2s ease-in-out}.document-container>.markdown-preview-view{margin:var(--sidebar-margin);margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;background-color:var(--background-primary);transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}.document-container>.markdown-preview-view>.markdown-preview-sizer{padding-bottom:80vh!important;width:100%!important;max-width:var(--line-width)!important;flex-basis:var(--line-width)!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}.markdown-rendered img:not([width]),.view-content img:not([width]){max-width:100%;outline:0}.document-container>.view-content.embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}.document-container>.view-content.embed>*{max-width:100%;max-height:100%;object-fit:contain}:has(> :is(.math,table)){overflow-x:auto!important}.document-container>.view-content{overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){if("file:"!=location.protocol){let e=document.querySelectorAll("include");for(let t=0;t<e.length;t++){let o=e[t],l=o.getAttribute("src");try{const e=await fetch(l);if(!e.ok){console.log("Could not include file: "+l),o?.remove();continue}let t=await e.text(),n=document.createRange().createContextualFragment(t),i=Array.from(n.children);for(let e of i)e.classList.add("hide"),e.style.transition="opacity 0.5s ease-in-out",setTimeout((()=>{e.classList.remove("hide")}),10);o.before(n),o.remove(),console.log("Included file: "+l)}catch(e){o?.remove(),console.log("Could not include file: "+l,e);continue}}}else{if(document.querySelectorAll("include").length>0){var e=document.createElement("div");e.id="error",e.textContent="Web server exports must be hosted on an http / web server to be viewed correctly.",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.fontSize="1.5em",e.style.fontWeight="bold",e.style.textAlign="center",document.body.appendChild(e),document.querySelector(".document-container")?.classList.remove("hide")}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script"))),l=0;!function e(){let n=o[l];l++,n&&"true"!=n.getAttribute("loaded")||l<o.length&&e(),l<o.length?n.addEventListener("load",e):t()}()}</script><link rel="stylesheet" href="lib/styles/obsidian.css"><link rel="stylesheet" href="lib/styles/theme.css"><link rel="preload" href="lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/main-styles.css"></noscript></head><body class="publish css-settings-manager theme-dark show-inline-title"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="webpage-container workspace"><div class="sidebar-left sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme_toggle"><input class="theme-toggle-input" type="checkbox" id="theme_toggle"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="search-input-container"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div class="search-input-clear-button" aria-label="Clear search"></div></div><include src="lib/html/file-tree.html"></include></div><script defer="">let ls = document.querySelector(".sidebar-left"); ls.classList.add("is-collapsed"); if (window.innerWidth > 768) ls.classList.remove("is-collapsed"); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div><div class="document-container markdown-reading-view hide"><div class="markdown-preview-view markdown-rendered allow-fold-headings allow-fold-lists is-readable-line-width"><style id="MJX-CHTML-styles"></style><pre class="frontmatter language-yaml" tabindex="0" style="display: none;"><code class="language-yaml is-loaded"></code><button class="copy-code-button">Copy</button></pre><div class="markdown-preview-sizer markdown-preview-section"><h1 class="page-title heading inline-title" id="Setup Analysis Enviroment"><p>Setup Analysis Enviroment</p></h1><div><hr></div><div><ul>
<li data-line="0">Tags: <a href="?query=tag:teoria" class="tag" target="_blank" rel="noopener">#teoria</a> <a href="?query=tag:practica" class="tag" target="_blank" rel="noopener">#practica</a> <a href="?query=tag:blue" class="tag" target="_blank" rel="noopener">#blue</a> <a href="?query=tag:analysis" class="tag" target="_blank" rel="noopener">#analysis</a> <a href="?query=tag:malware" class="tag" target="_blank" rel="noopener">#malware</a></li>
</ul></div><div><hr></div><div class="heading-wrapper"><h1 data-heading="Entorno de análisis de Malware" class="heading" id="Entorno_de_análisis_de_Malware">Entorno de análisis de Malware</h1><div class="heading-children"><div><p>Para analizar y trabajar con malware, es importante tener en cuenta que es una actividad muy riesgosa, la cual puede conllevar a múltiples peligros como usuario, desde persistencia, commands and controls, etc. por lo que para análizar muestras de malware haremos uso de un entorno de análisis el configuraremos el cual permitirá por un lado analizar el comportamiento del host tras la detonación del malware, como por otro, simular la red para recibir las peticiones que realize el malware.</p></div><div><p>En este entorno haremos uso de dos máquinas virtuales aisladas de la red principal para no poner en riesgo la máquina host, este entorno contará con dos máquinas virtuales con conexión entre si donde una tendrá el sistema operativo Windows 10 x64 bits a la cual se le instalará Flare-VM y por otro lado, una máquina Linux que contará acon <a data-tooltip-position="top" aria-label="https://remnux.org/" rel="noopener" class="external-link" href="https://remnux.org/" target="_blank">remnux</a>.</p></div><div><hr></div></div></div><div class="heading-wrapper"><h1 data-heading="Setup Enviroment" class="heading" id="Setup_Enviroment">Setup Enviroment</h1><div class="heading-children"><div class="heading-wrapper"><h3 data-heading="Linux (Remnux)" class="heading" id="Linux_(Remnux)"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Linux (Remnux)</h3><div class="heading-children"><div><p>La primera máquina que formará parte de nuestro entorno de análisis es una máquina Linux que cuenta con <strong>Remnux</strong>, el cual es un popular kit de herramientas basado en Linux para analizar software malicioso de ingeniería inversa en el que los analistas de malware han estado confiando durante mucho tiempo para ayudarlos a investigar rápidamente programas sospechosos, sitios web y ficheros o archivos de documentos.</p></div><div class="heading-wrapper"><h6 data-heading="Instalación de Remmux" class="heading" id="Instalación_de_Remmux"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Instalación de Remmux</h6><div class="heading-children"><div><p>En esta caso la instalación consta en dirigirnos al <a data-tooltip-position="top" aria-label="https://remnux.org/" rel="noopener" class="external-link" href="https://remnux.org/" target="_blank">sitio oficial de descarga</a> para descargar el <strong>OVA</strong> el cual posteriormente deberá ser utilizado para crear una máquina virtual en nuestro gestor de máquinas virtuales favorito.</p></div></div></div></div></div><div class="heading-wrapper"><h3 data-heading="Windows 10 (Flare-VM)" class="heading" id="Windows_10_(Flare-VM)"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Windows 10 (Flare-VM)</h3><div class="heading-children"><div><p>La segunda y última máquina de nuetro entorno es una máquina Windows x64 que contará con <strong>Flare-VM</strong>, la cual es una suite de scripts de instalación de software para sistemas Windows que permite configurar y mantener fácilmente un entorno de ingeniería inversa en una máquina virtual. Esta suite incluye una variedad de herramientas y software preinstalado que los investigadores de seguridad y analistas de malware pueden utilizar para analizar, depurar y desmontar programas maliciosos, así como para investigar incidentes de seguridad en sistemas Windows. </p></div><div class="heading-wrapper"><h6 data-heading="Instalación de Flare-VM" class="heading" id="Instalación_de_Flare-VM"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Instalación de Flare-VM</h6><div class="heading-children"><div><p>En este caso la instalación es un poco más extensa, primero que nada nos tenemos que descargar una <strong>.iso</strong> de un sistema Windows x64 bits (Esto se puede hacer desde <a data-tooltip-position="top" aria-label="https://www.microsoft.com/en-us/evalcenter/download-windows-10-enterprise" rel="noopener" class="external-link" href="https://www.microsoft.com/en-us/evalcenter/download-windows-10-enterprise" target="_blank">aquí</a>), una vez descargada procederiamos a crear una máquina virtual haciendo uso de esta imagen iso y de nuestras configuraciones favoritas (En caso de sufrir problemas relacionados al error <em>Windows cannot find the Microsoft Software License Terms</em> ver <a data-tooltip-position="top" aria-label="https://www.youtube.com/watch?v=FgeZfpLUTGs&amp;t" rel="noopener" class="external-link" href="https://www.youtube.com/watch?v=FgeZfpLUTGs&amp;t" target="_blank">este video</a>), una vez terminado este proceso continuariamos con los comandos a ejecutar. </p></div><div><p>Una vez instalado Windows y estando dentro de el, procederemos a ejecutar en la <em>PowerShell</em> como <em>Administrador</em> los siguientes comandos: </p></div><div><pre class="language-powershell" tabindex="0"><code class="language-powershell is-loaded"><span class="token comment"># Install VCLibs</span>
wget https:<span class="token operator">/</span><span class="token operator">/</span>aka<span class="token punctuation">.</span>ms/Microsoft<span class="token punctuation">.</span>VCLibs<span class="token punctuation">.</span>x64<span class="token punctuation">.</span>14<span class="token punctuation">.</span>00<span class="token punctuation">.</span>Desktop<span class="token punctuation">.</span>appx <span class="token operator">-</span>usebasicparsing <span class="token operator">-</span>o VCLibs<span class="token punctuation">.</span>appx

<span class="token comment"># Install Windows Terminal MSIX bundle</span>
wget https:<span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com/microsoft/terminal/releases/download/v1<span class="token punctuation">.</span>15<span class="token punctuation">.</span>3465<span class="token punctuation">.</span>0/Microsoft<span class="token punctuation">.</span>WindowsTerminal_Win10_1<span class="token punctuation">.</span>15<span class="token punctuation">.</span>3465<span class="token punctuation">.</span>0_8wekyb3d8bbwe<span class="token punctuation">.</span>msixbundle <span class="token operator">-</span>UseBasicParsing <span class="token operator">-</span>o winterminal<span class="token punctuation">.</span>msixbundle

<span class="token comment"># Add the VClibs package</span>
<span class="token function">Add-AppxPackage</span> <span class="token namespace">[C:\path\to\downloaded\VCLibs.appx]</span>

<span class="token comment"># Add the Windows terminal MSIX bundle package</span>
<span class="token function">Add-AppxPackage</span> <span class="token namespace">[C:\path\to\downloaded\winterminal.msixbundle]</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><p>Una vez realizada la instalación de los paquetes anteriores y habiendolos agregado, procederemos con la <strong>desactivación</strong> de la opción <strong>Automatically detect settings</strong> en el apartado de <strong>proxy settings</strong>. Así mismo también deberemos desactivar el <strong>Windows Defender</strong>, para esto seguiremos los siguientes pasos:</p></div><div><ul>
<li data-line="0">Buscar <strong>Defender</strong> en la barra de tareas, ingresar en las <strong>configuraciones</strong> del Windows Defender y cambiar a <strong>off</strong> todas las opciones del Defender.</li>
<li data-line="1">Para deshabilitar el Defender en el GPO nos dirigimos a <strong>group policy</strong> en la barra de tareas, posteriormente, una vez en el GPO nos dirigimos a -&gt; <strong>Administrative Templates</strong> -&gt; <strong>Windows Componentes</strong> -&gt; <strong>Microsoft Defender Antivirus</strong> -&gt; Enable <strong>Turn off Microsoft Defender Antivirus</strong>. </li>
</ul></div><div><p>Una vez hecho esto, procederemos a deshabilitar el <strong>Windows Firewall</strong>, para esto seguiremos los siguientes pasos:</p></div><div><ul>
<li data-line="0">Buscar <strong>group policy</strong> en la barra de tareas, posteriormente, una vez en el GPO nos dirigimos a -&gt; <strong>Administrative Templates</strong> -&gt; <strong>Network</strong> -&gt; <strong>Network Connections</strong> -&gt; <strong>Windows Defender Firewall</strong> -&gt; <em>Domain Profile</em> -&gt; Deshabilitar <strong>Protect All Network Connections</strong>. Este proceso también deberá ser repetido para el <em>Standar Profile</em>.</li>
</ul></div><div><p>En este punto, se recomendaría realizar una <strong>SNAPSHOT</strong> de nuestra máquina virtual con las configuraciones aplicadas.</p></div><div><p>Posterior a esto, continuaremos con la descarga de <em>Flare-VM</em>. </p></div><div><pre class="language-powershell" tabindex="0"><code class="language-powershell is-loaded"><span class="token comment"># In the Desktop -&gt; Install FLARE-VM</span>
<span class="token punctuation">(</span><span class="token function">New-Object</span> net<span class="token punctuation">.</span>webclient<span class="token punctuation">)</span><span class="token punctuation">.</span>DownloadFile<span class="token punctuation">(</span><span class="token string">'https://raw.githubusercontent.com/mandiant/flare-vm/main/install.ps1'</span><span class="token punctuation">,</span><span class="token string">"$([Environment]::GetFolderPath("</span>Desktop<span class="token string">"))\install.ps1"</span><span class="token punctuation">)</span>

<span class="token function">Unblock-File</span> <span class="token punctuation">.</span>\install<span class="token punctuation">.</span>ps1

<span class="token function">Set-ExecutionPolicy</span> Unrestricted

<span class="token comment"># Accept the prompt to set the ExecPol to unrestricted if one appears</span>

<span class="token punctuation">.</span>\install<span class="token punctuation">.</span>ps1 <span class="token operator">-</span>customConfig https:<span class="token operator">/</span><span class="token operator">/</span>raw<span class="token punctuation">.</span>githubusercontent<span class="token punctuation">.</span>com/HuskyHacks/PMAT-labs/main/config<span class="token punctuation">.</span>xml
</code><button class="copy-code-button">Copy</button></pre></div><div><p>Una vez ejecutados estos comandos, contunaremos hasta que finalize la instalación y una vez finalizada la misma, tomaremos otra <strong>SNAPSHOT</strong> con las configuraciones aplicadas a la par que la resiente <em>Flare-VM</em> instalada y configurada. </p></div></div></div></div></div><div class="heading-wrapper"><h2 data-heading="Network Setup" class="heading" id="Network_Setup"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Network Setup</h2><div class="heading-children"><div><p>Como se menciono anteriormente, en este caso es de vital importancia que este entorno de análisis de malware se encuentre <strong>totalmente aislado</strong>, es decir,  sin conexión con nuestro host, por lo que la configuración de la red del mismo es clave para tener un entorno seguro. En este caso deberemos verificar y configurar que ninguna de las dos máquinas virtuales que conforman nuestro entorno se encuentren en modo <em>Bridged</em>.</p></div><div><p>La configuración de red necesaria en caso de contar con <strong>VMWare Workstation PRO</strong> será crear una red (Esto será diferente según nuestro gestor de máquinas virtuales) en la cual ingresemos un segmento de red que diferencia a simple vista nuestra red local e ingresar ambas máquinas a esta nueva red creada. Esto lo podemos hacer yendo a <strong>Edit</strong> -&gt; <strong>Virtual Network Editor...</strong> -&gt; <strong>Change Settings</strong> (Esto pedirá permisos de administrador) -&gt; <strong>Add Network</strong>. </p></div><div><p>Una vez configurada a nuestro gusto la red, la misma se verá algo así: </p></div><div><p><span alt="network_setup_malware_analysis.png" src="network_setup_malware_analysis.png" class="internal-embed media-embed image-embed is-loaded"><img alt="network_setup_malware_analysis.png" src="lib/media/network_setup_malware_analysis.png"></span></p></div><div><p>En este caso las configuraciones se realizaron en <strong>VMWare Workstation PRO</strong> y en la imagen se puede apreciar que además de nuestra red NAT, se creo una nueva (<em>VMnet1</em>) la cual tiene un segmento de red que nos permite diferenciar de manera rápida la red de nuestra red local. </p></div><div><p>Una vez creada esta red, deberemos configurar nuestras dos máquinas (Windows y Linux) para esto haremos click derecho sobre la máquina a modificar, nos dirigiremos a <strong>Settings</strong> -&gt; <strong>Network Adapter</strong> -&gt; y seleccionaremos la opcion <strong>Custom</strong> para seleccionar la red creada, en este caso <em>VMnet1</em>.</p></div><div><p><span alt="network_adapter_settings_vmware.png" src="network_adapter_settings_vmware.png" class="internal-embed media-embed image-embed is-loaded"><img alt="network_adapter_settings_vmware.png" src="lib/media/network_adapter_settings_vmware.png"></span></p></div><div class="heading-wrapper"><h3 data-heading="Fake Internet Setup" class="heading" id="Fake_Internet_Setup"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Fake Internet Setup</h3><div class="heading-children"><div class="heading-wrapper"><h6 data-heading="Linux Machine Setup" class="heading" id="Linux_Machine_Setup"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Linux Machine Setup</h6><div class="heading-children"><div><p>En este caso, como se menciono anteriormente la máquina Windows nos permitirá análizar que ocurre con esta cuando el malware es detonado, mientras que la máquina Linux funcionará como un <strong>Fake Internet</strong> permitiendonos recibir todas las peticiones que se realizen a nivel de red, ya sea HTTP, DNS, etc.</p></div><div><p>Para esto es importante configurar el software proveniente con <strong>remnux</strong> que nos permitirá realizar esto, por lo que en nuestra máquina Linux modificaremos la configuración de la herramienta <strong>inetsim</strong> la cual nos permitirá realizar esto:</p></div><div><pre class="language-bash" tabindex="0"><code class="language-bash is-loaded"><span class="token function">sudo</span> <span class="token function">nano</span> /etc/inetsim/inetsim.conf
</code><button class="copy-code-button">Copy</button></pre></div><div><p>En este caso nos intereza realizar los siguientes cambios:</p></div><div><ul>
<li data-line="0">
<p>Descomentar la línea que se encarga de levantar el servidor DNS:<br>
<strong><a href="?query=tag:start_service" class="tag" target="_blank" rel="noopener">#start_service</a> dns</strong></p>
</li>
<li data-line="3">
<p>Modificar la línea de <em>service bind address</em> con el valor <em>0.0.0.0</em>:<br>
<strong>service_bind_address       0.0.0.0</strong></p>
</li>
<li data-line="6">
<p>Modificar el apartado <em>default IP</em> de la sección <em>service DNS</em> por la IP de nuestra máquina virtual de remnux, esto lo podemos ver con el comanod <code>hostname -I</code>:<br>
<strong>dns_default_ip    {remnux_IP}</strong></p>
</li>
</ul></div><div><p>Una vez configurado esto, con el comando <code>inetsim</code> podremos inicializar nuestra <em>fake network</em>. </p></div></div></div><div class="heading-wrapper"><h6 data-heading="Windows Machine Setup" class="heading" id="Windows_Machine_Setup"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Windows Machine Setup</h6><div class="heading-children"><div><p>Una vez realizadas las configuraciones pertinentes en la máquina linux, deberemos modificar nuestro servidor DNS para que este sea el de nuestra máquina Linux Remnux recientemente configurada, para esto procederemos a ir al apartado de <strong>Network Connections</strong> en nuestra máquina Windows Flare-VM, posteriormente a nuestro <strong>Ethernet0</strong> -&gt; <strong>Properties</strong> -&gt; <strong>Internet Protocol Version 4 (TCP/IPv4)</strong> y modiciamos las propiedades para hacer uso de un servidor DNS ingresado manualmente, el cual será nuestra máquina Linux Remnux, por lo que marcamos la opción <strong>Use the following DNS server addresses:</strong> y posteriormente ingresamos en <strong>Preferred DNS server:</strong> la IP de nuestra máquina Linux Remnux.</p></div><div><p>De esta manera todas las peticiones que pueda llegar a realizar un malware se recibiran y procesaran por nuestra máquina Linux Remnux. </p></div><div><hr></div></div></div></div></div></div></div></div></div><div class="heading-wrapper"><h1 data-heading="Analysis" class="heading" id="Analysis">Analysis</h1><div class="heading-children"><div class="mod-footer"></div></div></div></div></div></div><div class="sidebar-right sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="graph-view-wrapper"><div class="sidebar-section-header">Interactive Graph</div><div class="graph-view-placeholder">
		<div class="graph-view-container">
			<div class="graph-icon graph-expand" role="button" aria-label="Expand" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div>
			<canvas id="graph-canvas" class="hide" width="512px" height="512px"></canvas>
		</div>
		</div></div><div class="tree-container mod-root nav-folder tree-item outline-tree" data-depth="0"><div class="tree-header"><span class="sidebar-section-header">Table Of Contents</span><button class="clickable-icon collapse-tree-button" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-scroll-area tree-item-children nav-folder-children"><div class="tree-item mod-tree-folder nav-folder mod-collapsible is-collapsed" style="display: none;"></div><div class="tree-item" data-depth="1"><a class="tree-link" href="notes\4.-cybersecurity\blueteam\malware-analysis\sistem\setup-analysis-enviroment.html#Setup Analysis Enviroment"><div class="tree-item-contents heading-link" heading-name="Setup Analysis Enviroment"><span class="tree-item-title">Setup Analysis Enviroment</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="notes\4.-cybersecurity\blueteam\malware-analysis\sistem\setup-analysis-enviroment.html#Entorno_de_análisis_de_Malware"><div class="tree-item-contents heading-link" heading-name="Entorno de análisis de Malware"><span class="tree-item-title">Entorno de análisis de Malware</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="notes\4.-cybersecurity\blueteam\malware-analysis\sistem\setup-analysis-enviroment.html#Setup_Enviroment"><div class="tree-item-contents heading-link" heading-name="Setup Enviroment"><span class="tree-item-title">Setup Enviroment</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="notes\4.-cybersecurity\blueteam\malware-analysis\sistem\setup-analysis-enviroment.html#Linux_(Remnux)"><div class="tree-item-contents heading-link" heading-name="Linux (Remnux)"><span class="tree-item-title">Linux (Remnux)</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="6"><a class="tree-link" href="notes\4.-cybersecurity\blueteam\malware-analysis\sistem\setup-analysis-enviroment.html#Instalación_de_Remmux"><div class="tree-item-contents heading-link" heading-name="Instalación de Remmux"><span class="tree-item-title">Instalación de Remmux</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="notes\4.-cybersecurity\blueteam\malware-analysis\sistem\setup-analysis-enviroment.html#Windows_10_(Flare-VM)"><div class="tree-item-contents heading-link" heading-name="Windows 10 (Flare-VM)"><span class="tree-item-title">Windows 10 (Flare-VM)</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="6"><a class="tree-link" href="notes\4.-cybersecurity\blueteam\malware-analysis\sistem\setup-analysis-enviroment.html#Instalación_de_Flare-VM"><div class="tree-item-contents heading-link" heading-name="Instalación de Flare-VM"><span class="tree-item-title">Instalación de Flare-VM</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-link" href="notes\4.-cybersecurity\blueteam\malware-analysis\sistem\setup-analysis-enviroment.html#Network_Setup"><div class="tree-item-contents heading-link" heading-name="Network Setup"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">Network Setup</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="notes\4.-cybersecurity\blueteam\malware-analysis\sistem\setup-analysis-enviroment.html#Fake_Internet_Setup"><div class="tree-item-contents heading-link" heading-name="Fake Internet Setup"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">Fake Internet Setup</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="6"><a class="tree-link" href="notes\4.-cybersecurity\blueteam\malware-analysis\sistem\setup-analysis-enviroment.html#Linux_Machine_Setup"><div class="tree-item-contents heading-link" heading-name="Linux Machine Setup"><span class="tree-item-title">Linux Machine Setup</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="6"><a class="tree-link" href="notes\4.-cybersecurity\blueteam\malware-analysis\sistem\setup-analysis-enviroment.html#Windows_Machine_Setup"><div class="tree-item-contents heading-link" heading-name="Windows Machine Setup"><span class="tree-item-title">Windows Machine Setup</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="notes\4.-cybersecurity\blueteam\malware-analysis\sistem\setup-analysis-enviroment.html#Analysis"><div class="tree-item-contents heading-link" heading-name="Analysis"><span class="tree-item-title">Analysis</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div><script defer="">let rs = document.querySelector(".sidebar-right"); rs.classList.add("is-collapsed"); if (window.innerWidth > 768) rs.classList.remove("is-collapsed"); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></body></html>