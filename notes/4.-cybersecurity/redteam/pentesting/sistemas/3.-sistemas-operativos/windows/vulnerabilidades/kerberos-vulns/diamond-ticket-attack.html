<!DOCTYPE html> <html><head>
		<title>Diamond Ticket Attack</title>
		<base href="..\..\..\..\..\..\..\..\../">
		<meta id="root-path" root-path="..\..\..\..\..\..\..\..\../">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0">
		<meta charset="UTF-8">
		<meta name="description" content="Hacking - Diamond Ticket Attack">
		<meta property="og:title" content="Diamond Ticket Attack">
		<meta property="og:description" content="Hacking - Diamond Ticket Attack">
		<meta property="og:type" content="website">
		<meta property="og:url" content="notes/4.-cybersecurity/redteam/pentesting/sistemas/3.-sistemas-operativos/windows/vulnerabilidades/kerberos-vulns/diamond-ticket-attack.html">
		<meta property="og:image" content="undefined">
		<meta property="og:site_name" content="Hacking">
		<link rel="alternate" type="application/rss+xml" title="RSS Feed" href="lib/rss.xml"><script async="" id="webpage-script" src="lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script type="module" async="" id="graph-view-script" src="lib/scripts/graph-view.js"></script><script async="" id="graph-wasm-script" src="lib/scripts/graph-wasm.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-render-worker-script" src="lib/scripts/graph-render-worker.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="tinycolor-script" src="lib/scripts/tinycolor.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="pixi-script" src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.0/pixi.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="minisearch-script" src="https://cdn.jsdelivr.net/npm/minisearch@6.3.0/dist/umd/index.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="lib/media/favicon.png"><script async="" id="graph-data-script" src="lib/scripts/graph-data.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-horizontal-spacing:0.6em;--tree-vertical-spacing:0.6em;--sidebar-margin:12px}.sidebar{height:100%;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));font-size:14px;z-index:10;position:relative;overflow:hidden;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}.sidebar-left{left:0}.sidebar-right{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}body.floating-sidebars .sidebar{position:absolute}.sidebar-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .sidebar-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}.sidebar-left .sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}.sidebar-right .sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar:has(.sidebar-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:2em;width:var(--sidebar-width);top:var(--sidebar-margin);padding-inline:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}.sidebar-left .sidebar-topbar{left:0}.sidebar-right .sidebar-topbar{right:0}.topbar-content{overflow:hidden;overflow:clip;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:0!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}.sidebar-left .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}.sidebar-right .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.sidebar-section-header{margin:0 0 1em 0;text-transform:uppercase;letter-spacing:.06em;font-weight:600}body{transition:background-color var(--color-fade-speed) ease-in-out}.webpage-container{display:flex;flex-direction:row;height:100%;width:100%;align-items:stretch;justify-content:center}.document-container{opacity:1;flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0;transition:opacity .2s ease-in-out}.document-container>.markdown-preview-view{margin:var(--sidebar-margin);margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;background-color:var(--background-primary);transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}.document-container>.markdown-preview-view>.markdown-preview-sizer{padding-bottom:80vh!important;width:100%!important;max-width:var(--line-width)!important;flex-basis:var(--line-width)!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}.markdown-rendered img:not([width]),.view-content img:not([width]){max-width:100%;outline:0}.document-container>.view-content.embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}.document-container>.view-content.embed>*{max-width:100%;max-height:100%;object-fit:contain}:has(> :is(.math,table)){overflow-x:auto!important}.document-container>.view-content{overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){if("file:"!=location.protocol){let e=document.querySelectorAll("include");for(let t=0;t<e.length;t++){let o=e[t],l=o.getAttribute("src");try{const e=await fetch(l);if(!e.ok){console.log("Could not include file: "+l),o?.remove();continue}let t=await e.text(),n=document.createRange().createContextualFragment(t),i=Array.from(n.children);for(let e of i)e.classList.add("hide"),e.style.transition="opacity 0.5s ease-in-out",setTimeout((()=>{e.classList.remove("hide")}),10);o.before(n),o.remove(),console.log("Included file: "+l)}catch(e){o?.remove(),console.log("Could not include file: "+l,e);continue}}}else{if(document.querySelectorAll("include").length>0){var e=document.createElement("div");e.id="error",e.textContent="Web server exports must be hosted on an http / web server to be viewed correctly.",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.fontSize="1.5em",e.style.fontWeight="bold",e.style.textAlign="center",document.body.appendChild(e),document.querySelector(".document-container")?.classList.remove("hide")}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script"))),l=0;!function e(){let n=o[l];l++,n&&"true"!=n.getAttribute("loaded")||l<o.length&&e(),l<o.length?n.addEventListener("load",e):t()}()}</script><link rel="stylesheet" href="lib/styles/obsidian.css"><link rel="stylesheet" href="lib/styles/theme.css"><link rel="preload" href="lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/main-styles.css"></noscript></head><body class="publish css-settings-manager theme-dark show-inline-title"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="webpage-container workspace"><div class="sidebar-left sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme_toggle"><input class="theme-toggle-input" type="checkbox" id="theme_toggle"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="search-input-container"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div class="search-input-clear-button" aria-label="Clear search"></div></div><include src="lib/html/file-tree.html"></include></div><script defer="">let ls = document.querySelector(".sidebar-left"); ls.classList.add("is-collapsed"); if (window.innerWidth > 768) ls.classList.remove("is-collapsed"); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div><div class="document-container markdown-reading-view hide"><div class="markdown-preview-view markdown-rendered allow-fold-headings allow-fold-lists is-readable-line-width"><style id="MJX-CHTML-styles"></style><div class="markdown-preview-sizer markdown-preview-section"><h1 class="page-title heading inline-title" id="Diamond Ticket Attack"><p>Diamond Ticket Attack</p></h1><div><hr></div><div><ul>
<li data-line="0">Tags: <a href="?query=tag:toeria" class="tag" target="_blank" rel="noopener">#toeria</a> <a href="?query=tag:practica" class="tag" target="_blank" rel="noopener">#practica</a> <a href="?query=tag:ataque" class="tag" target="_blank" rel="noopener">#ataque</a> </li>
</ul></div><div><hr></div><div class="heading-wrapper"><h1 data-heading="[Diamond Ticket Attack](https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/diamond-ticket)" class="heading" id="[Diamond_Ticket_Attack](https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/diamond-ticket)"><a data-tooltip-position="top" aria-label="https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/diamond-ticket" rel="noopener" class="external-link" href="https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/diamond-ticket" target="_blank">Diamond Ticket Attack</a></h1><div class="heading-children"><div><p>El ataque <strong>Diamond Ticket</strong> así como el <a data-href="Golden Ticket Attack" href="notes/4.-cybersecurity/redteam/pentesting/sistemas/3.-sistemas-operativos/windows/vulnerabilidades/kerberos-vulns/golden-ticket-attack.html" class="internal-link" target="_self" rel="noopener">Golden Ticket Attack</a>, permite obtener acceso a cualquier servicio como cualquier usuario. El <strong>Golden Ticket</strong> se falsifica completamente fuera de línea, se cifra con el hash krbtgt de ese dominio y luego se pasa a una sesión de inicio de sesión para su uso. El problema es que existen dos técnicas habituales para detectar el uso de <strong>golden tickets</strong> y es por la busqueda de <strong>TGS-REQ</strong> que no tengan <strong>AS-REQ</strong> (Mirar <a data-href="KERBEROS_AUTHETICATION_FLOW" href="notes/5.-tecnologías/services/kerberos/kerberos_authetication_flow.html" class="internal-link" target="_self" rel="noopener">KERBEROS_AUTHETICATION_FLOW</a>) o buscando <strong>TGT</strong> que tengan valores 'tontos' como vida útil predeterminada de 10 años de <strong>Mimikatz</strong>.<br>
Ahora... un <strong>diamond ticket</strong> se genera modificando los campos de un TGT legítimo emitido por un DC. Esto se logra solicitando un TGT, descifrándolo con el hash krbtgt del dominio, modificando los campos deseados del ticket y luego volviéndolo a cifrar. Esto supera las dos deficiencias del <a data-href="Golden Ticket Attack" href="notes/4.-cybersecurity/redteam/pentesting/sistemas/3.-sistemas-operativos/windows/vulnerabilidades/kerberos-vulns/golden-ticket-attack.html" class="internal-link" target="_self" rel="noopener">Golden Ticket Attack</a>. Dado que el TGT es legítimo, tiene un AS-REQ previo así como al haber sido emitido por el DC, tendrá todos los detalles correctos.</p></div><div><hr></div></div></div><div class="heading-wrapper"><h1 data-heading="Explotación" class="heading" id="Explotación">Explotación</h1><div class="heading-children"><div><ul>
<li data-line="0">
<h3 data-heading="**Recolección de Información**: En el ataque Diamond Ticket, el atacante comienza recopilando información crítica sobre la infraestructura de red del objetivo. Esto puede incluir la obtención del Hash NT de la cuenta **KRBTGT** en el Domain Controller, que es **esencial** para generar el Diamond Ticket." class="heading" id="**Recolección_de_Información**:_En_el_ataque_Diamond_Ticket,_el_atacante_comienza_recopilando_información_crítica_sobre_la_infraestructura_de_red_del_objetivo._Esto_puede_incluir_la_obtención_del_Hash_NT_de_la_cuenta_**KRBTGT**_en_el_Domain_Controller,_que_es_**esencial**_para_generar_el_Diamond_Ticket."><strong>Recolección de Información</strong>: En el ataque Diamond Ticket, el atacante comienza recopilando información crítica sobre la infraestructura de red del objetivo. Esto puede incluir la obtención del Hash NT de la cuenta <strong>KRBTGT</strong> en el Domain Controller, que es <strong>esencial</strong> para generar el Diamond Ticket.</h3>
</li>
<li data-line="2">
<h3 data-heading="**Obtención de Credenciales**: Para generar un Diamond Ticket, el atacante debe obtener el **hash NT del KRBTGT** y otros datos sensibles del entorno, similar al Golden Ticket. Esto puede lograrse mediante técnicas como el robo de credenciales a través de herramientas como **Mimikatz** o mediante la explotación de vulnerabilidades." class="heading" id="**Obtención_de_Credenciales**:_Para_generar_un_Diamond_Ticket,_el_atacante_debe_obtener_el_**hash_NT_del_KRBTGT**_y_otros_datos_sensibles_del_entorno,_similar_al_Golden_Ticket._Esto_puede_lograrse_mediante_técnicas_como_el_robo_de_credenciales_a_través_de_herramientas_como_**Mimikatz**_o_mediante_la_explotación_de_vulnerabilidades."><strong>Obtención de Credenciales</strong>: Para generar un Diamond Ticket, el atacante debe obtener el <strong>hash NT del KRBTGT</strong> y otros datos sensibles del entorno, similar al Golden Ticket. Esto puede lograrse mediante técnicas como el robo de credenciales a través de herramientas como <strong>Mimikatz</strong> o mediante la explotación de vulnerabilidades.</h3>
</li>
<li data-line="4">
<h3 data-heading="**Generación del Diamond Ticket**: Con el hash NT del KRBTGT y otros datos recopilados, el atacante utiliza herramientas especializadas para crear un Diamond Ticket. Este ticket forjado se firma criptográficamente y es prácticamente indistinguible de un TGT legítimo, al igual que en el Golden Ticket Attack." class="heading" id="**Generación_del_Diamond_Ticket**:_Con_el_hash_NT_del_KRBTGT_y_otros_datos_recopilados,_el_atacante_utiliza_herramientas_especializadas_para_crear_un_Diamond_Ticket._Este_ticket_forjado_se_firma_criptográficamente_y_es_prácticamente_indistinguible_de_un_TGT_legítimo,_al_igual_que_en_el_Golden_Ticket_Attack."><strong>Generación del Diamond Ticket</strong>: Con el hash NT del KRBTGT y otros datos recopilados, el atacante utiliza herramientas especializadas para crear un Diamond Ticket. Este ticket forjado se firma criptográficamente y es prácticamente indistinguible de un TGT legítimo, al igual que en el Golden Ticket Attack.</h3>
</li>
<li data-line="6">
<h3 data-heading="**Persistencia y Acceso Ilimitado**: Igual al Golden Ticket, el Diamond Ticket generado por el atacante tiene una vida útil larga y se puede utilizar de manera persistente. Proporciona acceso ilimitado a la red y a todos los recursos protegidos por el sistema de autenticación Kerberos, incluyendo servidores, sistemas de almacenamiento y otros recursos." class="heading" id="**Persistencia_y_Acceso_Ilimitado**:_Igual_al_Golden_Ticket,_el_Diamond_Ticket_generado_por_el_atacante_tiene_una_vida_útil_larga_y_se_puede_utilizar_de_manera_persistente._Proporciona_acceso_ilimitado_a_la_red_y_a_todos_los_recursos_protegidos_por_el_sistema_de_autenticación_Kerberos,_incluyendo_servidores,_sistemas_de_almacenamiento_y_otros_recursos."><strong>Persistencia y Acceso Ilimitado</strong>: Igual al Golden Ticket, el Diamond Ticket generado por el atacante tiene una vida útil larga y se puede utilizar de manera persistente. Proporciona acceso ilimitado a la red y a todos los recursos protegidos por el sistema de autenticación Kerberos, incluyendo servidores, sistemas de almacenamiento y otros recursos.</h3>
</li>
</ul></div><div><hr></div></div></div><div class="heading-wrapper"><h1 data-heading="PoC" class="heading" id="PoC">PoC</h1><div class="heading-children"><div><p>Por ejemplo, supongamos que tenemos acceso al sistema víctima, en donde contamos con <strong>rubeus</strong> (Herramienta para realizar ataques y pruebas de penetración en Windows, con gran capacidad de llevar a cabo ataques y tareas relacionadas con <a data-href="Kerberos" href="notes/5.-tecnologías/services/kerberos/kerberos.html" class="internal-link" target="_self" rel="noopener">Kerberos</a>), con esta herramienta podemos llevar acabo un <strong>Diamond Ticket Attack</strong>.<br>
Primero podríamos obtener el RID del usuario.</p></div><div><pre class="language-bash" tabindex="0"><code class="language-bash is-loaded">powershell Get-DomainUser -Identity <span class="token operator">&lt;</span>username<span class="token operator">&gt;</span> -Properties objectsid
</code><button class="copy-code-button">Copy</button></pre></div><div><p>Posteriormente hacer uso de <strong>rubeus</strong> para llevar a cabo este ataque. </p></div><div><pre class="language-bash" tabindex="0"><code class="language-bash is-loaded">.<span class="token punctuation">\</span>Rubeus.exe diamond /tgtdeleg /ticketuser:<span class="token punctuation">{</span>username<span class="token punctuation">}</span> /ticketuserid:<span class="token punctuation">{</span>RID_username<span class="token punctuation">}</span> /groups:512

<span class="token comment"># /tgtdeleg uses the Kerberos GSS-API to obtain a useable TGT for the user without needing to know their password, NTLM/AES hash, or elevation on the host.</span>
<span class="token comment"># /ticketuser is the username of the principal to impersonate.</span>
<span class="token comment"># /ticketuserid is the domain RID of that principal.</span>
<span class="token comment"># /groups are the desired group RIDs (512 being Domain Admins).</span>
<span class="token comment"># /krbkey is the krbtgt AES256 hash.</span>
</code><button class="copy-code-button">Copy</button></pre></div><div class="mod-footer"></div></div></div></div></div></div><div class="sidebar-right sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="graph-view-wrapper"><div class="sidebar-section-header">Interactive Graph</div><div class="graph-view-placeholder">
		<div class="graph-view-container">
			<div class="graph-icon graph-expand" role="button" aria-label="Expand" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div>
			<canvas id="graph-canvas" class="hide" width="512px" height="512px"></canvas>
		</div>
		</div></div><div class="tree-container mod-root nav-folder tree-item outline-tree" data-depth="0"><div class="tree-header"><span class="sidebar-section-header">Table Of Contents</span><button class="clickable-icon collapse-tree-button" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-scroll-area tree-item-children nav-folder-children"><div class="tree-item mod-tree-folder nav-folder mod-collapsible is-collapsed" style="display: none;"></div><div class="tree-item" data-depth="1"><a class="tree-link" href="notes\4.-cybersecurity\redteam\pentesting\sistemas\3.-sistemas-operativos\windows\vulnerabilidades\kerberos-vulns\diamond-ticket-attack.html#Diamond Ticket Attack"><div class="tree-item-contents heading-link" heading-name="Diamond Ticket Attack"><span class="tree-item-title">Diamond Ticket Attack</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="notes\4.-cybersecurity\redteam\pentesting\sistemas\3.-sistemas-operativos\windows\vulnerabilidades\kerberos-vulns\diamond-ticket-attack.html#[Diamond_Ticket_Attack](https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/diamond-ticket)"><div class="tree-item-contents heading-link" heading-name="[Diamond Ticket Attack](https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/diamond-ticket)"><span class="tree-item-title"><a data-tooltip-position="top" aria-label="https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/diamond-ticket" rel="noopener" class="external-link" href="https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/diamond-ticket" target="_blank">Diamond Ticket Attack</a></span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="notes\4.-cybersecurity\redteam\pentesting\sistemas\3.-sistemas-operativos\windows\vulnerabilidades\kerberos-vulns\diamond-ticket-attack.html#Explotación"><div class="tree-item-contents heading-link" heading-name="Explotación"><span class="tree-item-title">Explotación</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="notes\4.-cybersecurity\redteam\pentesting\sistemas\3.-sistemas-operativos\windows\vulnerabilidades\kerberos-vulns\diamond-ticket-attack.html#**Recolección_de_Información**:_En_el_ataque_Diamond_Ticket,_el_atacante_comienza_recopilando_información_crítica_sobre_la_infraestructura_de_red_del_objetivo._Esto_puede_incluir_la_obtención_del_Hash_NT_de_la_cuenta_**KRBTGT**_en_el_Domain_Controller,_que_es_**esencial**_para_generar_el_Diamond_Ticket."><div class="tree-item-contents heading-link" heading-name="**Recolección de Información**: En el ataque Diamond Ticket, el atacante comienza recopilando información crítica sobre la infraestructura de red del objetivo. Esto puede incluir la obtención del Hash NT de la cuenta **KRBTGT** en el Domain Controller, que es **esencial** para generar el Diamond Ticket."><span class="tree-item-title"><strong>Recolección de Información</strong>: En el ataque Diamond Ticket, el atacante comienza recopilando información crítica sobre la infraestructura de red del objetivo. Esto puede incluir la obtención del Hash NT de la cuenta <strong>KRBTGT</strong> en el Domain Controller, que es <strong>esencial</strong> para generar el Diamond Ticket.</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="notes\4.-cybersecurity\redteam\pentesting\sistemas\3.-sistemas-operativos\windows\vulnerabilidades\kerberos-vulns\diamond-ticket-attack.html#**Obtención_de_Credenciales**:_Para_generar_un_Diamond_Ticket,_el_atacante_debe_obtener_el_**hash_NT_del_KRBTGT**_y_otros_datos_sensibles_del_entorno,_similar_al_Golden_Ticket._Esto_puede_lograrse_mediante_técnicas_como_el_robo_de_credenciales_a_través_de_herramientas_como_**Mimikatz**_o_mediante_la_explotación_de_vulnerabilidades."><div class="tree-item-contents heading-link" heading-name="**Obtención de Credenciales**: Para generar un Diamond Ticket, el atacante debe obtener el **hash NT del KRBTGT** y otros datos sensibles del entorno, similar al Golden Ticket. Esto puede lograrse mediante técnicas como el robo de credenciales a través de herramientas como **Mimikatz** o mediante la explotación de vulnerabilidades."><span class="tree-item-title"><strong>Obtención de Credenciales</strong>: Para generar un Diamond Ticket, el atacante debe obtener el <strong>hash NT del KRBTGT</strong> y otros datos sensibles del entorno, similar al Golden Ticket. Esto puede lograrse mediante técnicas como el robo de credenciales a través de herramientas como <strong>Mimikatz</strong> o mediante la explotación de vulnerabilidades.</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="notes\4.-cybersecurity\redteam\pentesting\sistemas\3.-sistemas-operativos\windows\vulnerabilidades\kerberos-vulns\diamond-ticket-attack.html#**Generación_del_Diamond_Ticket**:_Con_el_hash_NT_del_KRBTGT_y_otros_datos_recopilados,_el_atacante_utiliza_herramientas_especializadas_para_crear_un_Diamond_Ticket._Este_ticket_forjado_se_firma_criptográficamente_y_es_prácticamente_indistinguible_de_un_TGT_legítimo,_al_igual_que_en_el_Golden_Ticket_Attack."><div class="tree-item-contents heading-link" heading-name="**Generación del Diamond Ticket**: Con el hash NT del KRBTGT y otros datos recopilados, el atacante utiliza herramientas especializadas para crear un Diamond Ticket. Este ticket forjado se firma criptográficamente y es prácticamente indistinguible de un TGT legítimo, al igual que en el Golden Ticket Attack."><span class="tree-item-title"><strong>Generación del Diamond Ticket</strong>: Con el hash NT del KRBTGT y otros datos recopilados, el atacante utiliza herramientas especializadas para crear un Diamond Ticket. Este ticket forjado se firma criptográficamente y es prácticamente indistinguible de un TGT legítimo, al igual que en el Golden Ticket Attack.</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="notes\4.-cybersecurity\redteam\pentesting\sistemas\3.-sistemas-operativos\windows\vulnerabilidades\kerberos-vulns\diamond-ticket-attack.html#**Persistencia_y_Acceso_Ilimitado**:_Igual_al_Golden_Ticket,_el_Diamond_Ticket_generado_por_el_atacante_tiene_una_vida_útil_larga_y_se_puede_utilizar_de_manera_persistente._Proporciona_acceso_ilimitado_a_la_red_y_a_todos_los_recursos_protegidos_por_el_sistema_de_autenticación_Kerberos,_incluyendo_servidores,_sistemas_de_almacenamiento_y_otros_recursos."><div class="tree-item-contents heading-link" heading-name="**Persistencia y Acceso Ilimitado**: Igual al Golden Ticket, el Diamond Ticket generado por el atacante tiene una vida útil larga y se puede utilizar de manera persistente. Proporciona acceso ilimitado a la red y a todos los recursos protegidos por el sistema de autenticación Kerberos, incluyendo servidores, sistemas de almacenamiento y otros recursos."><span class="tree-item-title"><strong>Persistencia y Acceso Ilimitado</strong>: Igual al Golden Ticket, el Diamond Ticket generado por el atacante tiene una vida útil larga y se puede utilizar de manera persistente. Proporciona acceso ilimitado a la red y a todos los recursos protegidos por el sistema de autenticación Kerberos, incluyendo servidores, sistemas de almacenamiento y otros recursos.</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="notes\4.-cybersecurity\redteam\pentesting\sistemas\3.-sistemas-operativos\windows\vulnerabilidades\kerberos-vulns\diamond-ticket-attack.html#PoC"><div class="tree-item-contents heading-link" heading-name="PoC"><span class="tree-item-title">PoC</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div><script defer="">let rs = document.querySelector(".sidebar-right"); rs.classList.add("is-collapsed"); if (window.innerWidth > 768) rs.classList.remove("is-collapsed"); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></body></html>